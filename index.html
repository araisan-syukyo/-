<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <title>日本は世界の縮図？</title>

  <!-- スマホ対応 -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- LeafletのCSS（CDN） -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

  <style>
    /* 全画面表示＆グラデーション背景 */
    html, body {
      margin: 0; padding: 0;
      height: 100%;
      font-family: sans-serif;
      background: linear-gradient(160deg, #edf7fa 0%, #bee8fa 100%);
    }

    /* タイトルヘッダー */
    header {
      position: fixed; 
      top: 0; 
      width: 100%;
      padding: 1rem;
      background: rgba(255, 255, 255, 0.95);
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      z-index: 999;

      /* ★ ヘッダー内を上下2行レイアウトにするために追加 */
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }
    /* タイトル行 */
    .header-top {
      display: flex;
      justify-content: space-between; 
      align-items: center;
    }
    .header-top h1 {
      margin: 0; font-size: 1.6rem; color: #333;
    }

    /* ★ 「ファンタジーとしてお楽しみ下さい」メッセージのスタイル */
    .fantasy-message {
      font-size: 0.95rem;
      color: #666;
      margin: 0; /* 見た目調整 */
    }

    /* ボタンエリア */
    .btn-area {
      display: flex; 
      gap: 0.5rem;
    }
    .tour-btn {
      padding: 0.5rem 1rem; 
      border: none; 
      border-radius: 4px;
      background-color: #67c0f5; 
      color: #fff; 
      font-size: 0.9rem;
      cursor: pointer; 
      transition: background-color 0.3s ease;
    }
    .tour-btn:hover {
      background-color: #42b0ec;
    }

    /* 地図本体 */
    #map {
      width: 100%; 
      height: calc(100% - 70px);
      margin-top: 70px; /* ヘッダーの高さに合わせる */
    }

    /* 点滅アニメーション */
    @keyframes markerBlink {
      0%   { transform: scale(1);   filter: brightness(1); }
      50%  { transform: scale(1.3); filter: brightness(2); }
      100% { transform: scale(1);   filter: brightness(1); }
    }
    .leaflet-marker-pane .blink-marker {
      animation: markerBlink 1s ease-in-out infinite;
    }
  </style>
</head>

<body>
<header>
  <!-- 上段：タイトル + ボタン -->
  <div class="header-top">
    <h1>日本は世界の縮図？</h1>
    <div class="btn-area">
      <!-- 従来ツアー（日本⇔世界）ボタン -->
      <button id="auto-tour-btn" class="tour-btn" onclick="startAutoTour()">自動ツアー開始</button>
      <button id="stop-btn" class="tour-btn" style="display:none;" onclick="stopAutoTour()">自動ツアー停止</button>

      <!-- 万国巡幸ツアーボタン -->
      <button id="ancient-tour-btn" class="tour-btn" onclick="startAncientTour()">
        万国巡幸ツアー 上古第三代・天日豊本黄人皇主神天皇の万国巡幸に基づく
      </button>
      <button id="ancient-stop-btn" class="tour-btn" style="display:none;" onclick="stopAncientTour()">
        万国巡幸ツアー停止
      </button>
    </div>
  </div>

  <!-- 下段：ファンタジー文言 -->
  <p class="fantasy-message">
    ファンタジーとしてお楽しみ下さい
  </p>
</header>

<div id="map"></div>

<!-- LeafletのJS -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
////////////////////////////////////////////////////////////////////////////////
// 1. 地図の初期化
////////////////////////////////////////////////////////////////////////////////
const map = L.map("map").setView([36, 138], 5);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
  attribution: "&copy; OpenStreetMap contributors"
}).addTo(map);

////////////////////////////////////////////////////////////////////////////////
// 2. 「日本は世界の縮図？」ペア関係データ（従来ツアー）
////////////////////////////////////////////////////////////////////////////////
const pairs = [
  // --- 大陸・地方 ---
  {
    nameJP: "北海道",
    latJP:  43.4, lngJP: 142.0,
    wikiJP: "https://ja.wikipedia.org/wiki/北海道",
    nameW:  "北アメリカ",
    latW:   40.0, lngW: -100.0,
    wikiW:  "https://ja.wikipedia.org/wiki/北アメリカ",
    zoomJP: 7, zoomW: 5
  },
  {
    nameJP: "本州",
    latJP:  35.0, lngJP: 137.0,
    wikiJP: "https://ja.wikipedia.org/wiki/本州",
    nameW:  "ユーラシア大陸",
    latW:   50.0, lngW: 60.0,
    wikiW:  "https://ja.wikipedia.org/wiki/ユーラシア大陸",
    zoomJP: 7, zoomW: 5
  },
  {
    nameJP: "四国",
    latJP:  33.0, lngJP: 133.0,
    wikiJP: "https://ja.wikipedia.org/wiki/四国",
    nameW:  "オーストラリア",
    latW:   -25.0, lngW: 135.0,
    wikiW:  "https://ja.wikipedia.org/wiki/オーストラリア",
    zoomJP: 7, zoomW: 6
  },
  {
    nameJP: "九州",
    latJP:  32.0, lngJP: 130.0,
    wikiJP: "https://ja.wikipedia.org/wiki/九州",
    nameW:  "アフリカ大陸",
    latW:   5.0, lngW: 20.0,
    wikiW:  "https://ja.wikipedia.org/wiki/アフリカ",
    zoomJP: 7, zoomW: 5
  },
  // ... 以下略（湖・海, 半島, 島のデータも含む） ...
];

// ▼ 世界側マーカー DOM (点滅用)
const wMarkerElems = {};
// ▼ マーカー配列
const jpMarkers = [];
const wMarkers = [];

// ▼ マーカー生成
pairs.forEach((pair, i) => {
  // 日本マーカー
  const jpMarker = L.marker([pair.latJP, pair.lngJP]).addTo(map);
  jpMarker.bindPopup(`
    <b>${pair.nameJP} - ${pair.nameW}</b><br>
    <a href="${pair.wikiJP}" target="_blank">${pair.nameJP}のWikipedia</a><br>
    <a href="${pair.wikiW}"  target="_blank">${pair.nameW}のWikipedia</a>
    <hr style="margin:6px 0">
    <button onclick="moveToWorld(${i})">対応した地点へ</button>
  `);
  jpMarkers.push(jpMarker);

  // 世界マーカー
  const wMarker = L.marker([pair.latW, pair.lngW]).addTo(map);
  wMarker.bindPopup(`
    <b>${pair.nameW} - ${pair.nameJP}</b><br>
    <a href="${pair.wikiW}"  target="_blank">${pair.nameW}のWikipedia</a><br>
    <a href="${pair.wikiJP}" target="_blank">${pair.nameJP}のWikipedia</a>
    <hr style="margin:6px 0">
    <button onclick="moveToJapan(${i})">日本に戻る</button>
  `);
  wMarkers.push(wMarker);

  // 点滅用DOM取得
  wMarker.on('add', () => {
    wMarkerElems[i] = wMarker.getElement();
  });
});

// ▼ 従来ツアー：移動 & 点滅
function moveToWorld(i) {
  const p = pairs[i];
  map.flyTo([p.latW, p.lngW], p.zoomW);
  setTimeout(() => {
    wMarkers[i].openPopup();
    blinkWorldMarker(i);
  }, 1000);
}
function moveToJapan(i) {
  const p = pairs[i];
  map.flyTo([p.latJP, p.lngJP], p.zoomJP);
  setTimeout(() => {
    jpMarkers[i].openPopup();
    removeAllBlinks();
  }, 1000);
}
function blinkWorldMarker(i) {
  removeAllBlinks();
  if (!wMarkerElems[i]) return;
  wMarkerElems[i].classList.add('blink-marker');
  setTimeout(() => {
    wMarkerElems[i].classList.remove('blink-marker');
  }, 3000);
}
function removeAllBlinks() {
  Object.values(wMarkerElems).forEach(el => el.classList.remove('blink-marker'));
}
function removeAllPopups() {
  jpMarkers.forEach(m => m.closePopup());
  wMarkers.forEach(m => m.closePopup());
}

////////////////////////////////////////////////////////////////////////////////
// 従来ツアー 自動巡回
////////////////////////////////////////////////////////////////////////////////
let autoTourTimer = null;
let autoTourIndex = 0;
let goingToWorld = true;

function startAutoTour() {
  stopAncientTour(); // 他のツアー(万国巡幸ツアー)を停止
  document.getElementById("auto-tour-btn").style.display = "none";
  document.getElementById("stop-btn").style.display = "inline-block";

  autoTourIndex = 0;
  goingToWorld = true;
  autoTourNext();
}
function autoTourNext() {
  if (autoTourIndex >= pairs.length) {
    autoTourIndex = 0;
  }
  if (goingToWorld) {
    moveToWorld(autoTourIndex);
    autoTourTimer = setTimeout(() => {
      goingToWorld = false;
      autoTourNext();
    }, 4000); 
  } else {
    moveToJapan(autoTourIndex);
    autoTourTimer = setTimeout(() => {
      goingToWorld = true;
      autoTourIndex++;
      autoTourNext();
    }, 4000);
  }
}
function stopAutoTour() {
  if (autoTourTimer) {
    clearTimeout(autoTourTimer);
    autoTourTimer = null;
  }
  document.getElementById("stop-btn").style.display = "none";
  document.getElementById("auto-tour-btn").style.display = "inline-block";

  removeAllBlinks();
  removeAllPopups();
}

////////////////////////////////////////////////////////////////////////////////
// 3. 万国巡幸ツアー（神代の万国史：竹内文書）
//    出典：「神代（かみよ）の万国史」
//    上古第三代・天日豊本黄人皇主神天皇の万国巡幸に基づく。
//    著作権などの権利保護のため、本コードを無断で複製・改変することを禁じます。
////////////////////////////////////////////////////////////////////////////////

// ★ 赤色アイコン
const redIcon = L.icon({
  iconUrl: "https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-red.png",
  shadowUrl: "https://unpkg.com/leaflet/dist/images/marker-shadow.png",
  iconSize:     [25, 41],
  iconAnchor:   [12, 41],
  popupAnchor:  [1, -34],
  shadowSize:   [41, 41]
});

// ▼ 万国巡幸(竹内文書)の巡幸地リスト（現代語）
const ancientPoints = [
  {
    name: "① 鎮江・チェンヤン（南京付近）",
    lat: 32.06, lng: 119.00,
    zoom: 6
  },
  {
    name: "② 保定（北京と天津付近）\n支那王・盤邦王民が天皇に唐みしを献上。\n天皇は勅命を出して支那国主に任命。",
    lat: 38.87, lng: 115.46,
    zoom: 6
  },
  {
    name: "③ イタリアのウェネチャ（ベニス）\nヨイモツアダムイブヒアカヒ女氏一行の五色人が早く到着し、\n黄人皇主天皇に草花を献上。\n天皇は勅命を出し、アカヒ女氏の一族が住む地を治める王に任命。",
    lat: 45.44, lng: 12.34,
    zoom: 7
  },
  {
    name: "④ アフリカのネネアホマ浜（ギニア付近）\nアフリアビシアム民王、アスカリトキンコンコク主民王が\n天日豊本黄人皇主天皇にキバナを献上。\n天皇は勅命を出し、彼らを国王に任命。",
    lat: 9.5, lng: -13.7,
    zoom: 6
  },
  {
    name: "⑤ オセアニアのメルボルン浜\nハウライムタイ尊者、ダイビ民玉が天皇の前に参拝。\n天皇は勅命を出して国主に任命。",
    lat: -37.81, lng: 144.96,
    zoom: 7
  },
  {
    name: "⑥ 南アメリカのラブラタ浜\n天皇がご巡幸。ヒウケイヒロブラシルコ民王、\nヒウケフラジルバラ民王が参朝して地図を献上。\n天皇は勅命を出し、二名を国主に任命。",
    lat: -34.60, lng: -58.38,
    zoom: 6
  },
  {
    name: "⑦ 北米カナダのニトアーク浜\n天皇のもとへアヒイタマヲ王アカ民王、\nエスキマルカス民王が参拝。\n天皇は勅命を出し、国主に任命。\nこの時からカナイシ国と呼ばれるようになる。",
    lat: 56.54, lng: -61.69,
    zoom: 6
  },
  {
    name: "⑧ 常盤国おつき浜\n万国巡幸が始まってから1950年目の\nカナメツキマドノミツヒの時代に、万国から\n吉道路・常磐国大付浜へ帰還。\nその場所を“唐（から）帰里”と名付ける。",
    lat: 37.0, lng: 140.7,
    zoom: 7
  }
];

// ▼ 万国巡幸マーカー
const ancientMarkers = [];
ancientPoints.forEach((p) => {
  const mk = L.marker([p.lat, p.lng], { icon: redIcon }).addTo(map);
  mk.bindPopup(`<b>${p.name.replace(/\n/g, "<br>")}</b>`);
  ancientMarkers.push(mk);
});

// ▼ 万国巡幸ツアー自動巡回
let ancientTourTimer = null;
let ancientTourIndex = 0;

function startAncientTour() {
  stopAutoTour(); // 他のツアー(従来ツアー)を停止
  document.getElementById("ancient-tour-btn").style.display = "none";
  document.getElementById("ancient-stop-btn").style.display = "inline-block";

  ancientTourIndex = 0;
  moveAncientNext();
}

function moveAncientNext() {
  if (ancientTourIndex >= ancientPoints.length) {
    ancientTourIndex = 0;
  }
  const p = ancientPoints[ancientTourIndex];
  map.flyTo([p.lat, p.lng], p.zoom);

  // 2秒後にポップアップを開き、6秒後に次へ
  setTimeout(() => {
    ancientMarkers[ancientTourIndex].openPopup();
    // 4秒後に次のポイントへ
    ancientTourTimer = setTimeout(() => {
      ancientTourIndex++;
      moveAncientNext();
    }, 6000);
  }, 2000);
}

function stopAncientTour() {
  if (ancientTourTimer) {
    clearTimeout(ancientTourTimer);
    ancientTourTimer = null;
  }
  document.getElementById("ancient-stop-btn").style.display = "none";
  document.getElementById("ancient-tour-btn").style.display = "inline-block";

  removeAllAncientPopups();
}

function removeAllAncientPopups() {
  ancientMarkers.forEach(m => m.closePopup());
}
</script>
</body>
</html>