<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <title>日本は世界の縮図？</title>

  <!-- スマホ対応 -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- LeafletのCSS（CDN） -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

  <style>
    /* 全画面表示＆グラデーション背景 */
    html, body {
      margin: 0; padding: 0;
      height: 100%;
      font-family: sans-serif;
      background: linear-gradient(160deg, #edf7fa 0%, #bee8fa 100%);
    }
    /* タイトルヘッダー */
    header {
      position: fixed; top: 0; width: 100%;
      display: flex; justify-content: space-between; align-items: center;
      padding: 1rem; background: rgba(255, 255, 255, 0.95);
      box-shadow: 0 2px 8px rgba(0,0,0,0.1); z-index: 999;
    }
    header h1 {
      margin: 0;
      font-size: 1.6rem;
      color: #333;
    }
    .btn-area {
      display: flex; gap: 0.5rem;
    }
    .tour-btn {
      padding: 0.5rem 1rem; border: none; border-radius: 4px;
      background-color: #67c0f5; color: #fff; font-size: 0.9rem;
      cursor: pointer; transition: background-color 0.3s ease;
    }
    .tour-btn:hover {
      background-color: #42b0ec;
    }
    /* 地図本体 */
    #map {
      width: 100%;
      height: calc(100% - 70px); /* ヘッダー高さを差し引く */
      margin-top: 70px;
    }
    /* 点滅アニメーション */
    @keyframes markerBlink {
      0%   { transform: scale(1);   filter: brightness(1); }
      50%  { transform: scale(1.3); filter: brightness(2); }
      100% { transform: scale(1);   filter: brightness(1); }
    }
    .leaflet-marker-pane .blink-marker {
      animation: markerBlink 1s ease-in-out infinite;
    }

    /* 停止メッセージ等（上部） */
    #statusMessage {
      position: fixed; top: 120px; right: 10px;
      padding: 8px 16px; background: rgba(0,0,0,0.7);
      color: #fff; border-radius: 4px;
      z-index: 9999; display: none;
    }
  </style>
</head>

<body>
<header>
  <h1>日本は世界の縮図？</h1>
  <div class="btn-area">
    <!-- 従来ツアー -->
    <button id="auto-tour-btn" class="tour-btn" onclick="startAutoTour()">自動ツアー</button>
    <button id="stop-btn" class="tour-btn" style="display:none;" onclick="stopAutoTour()">停止</button>

    <!-- 万国巡幸ツアー -->
    <button id="ancient-tour-btn" class="tour-btn" onclick="startAncientTour()">
      万国巡幸ツアー(竹内文書・皇祖皇太神宮)
    </button>
    <button id="ancient-stop-btn" class="tour-btn" style="display:none;" onclick="stopAncientTour()">
      停止
    </button>
  </div>
</header>

<div id="map"></div>
<div id="statusMessage"></div>

<!-- Leaflet本体 (CDN) -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<!-- 
  注意: 
    このファイルの JavaScript/CSS/HTML コード全体は MITライセンスとしますが、
    下記「万国巡幸の文章」は 
      © 2024 皇祖皇太神宮, All Rights Reserved (MITライセンス対象外) 
    となります。無断転載・改変は禁止とします。
-->
<script>
////////////////////////////////////////////////////////////////////////////////
// 1. 地図の初期化 (プログラム部分: MITライセンス)
////////////////////////////////////////////////////////////////////////////////
const map = L.map("map").setView([36, 138], 5);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
  attribution: "&copy; OpenStreetMap contributors"
}).addTo(map);

////////////////////////////////////////////////////////////////////////////////
// 2. 従来ツアー: 「日本は世界の縮図？」データ & 処理 (MITライセンス)
////////////////////////////////////////////////////////////////////////////////
const pairs = [
  {
    nameJP: "北海道",
    latJP: 43.4, lngJP: 142.0,
    wikiJP: "https://ja.wikipedia.org/wiki/北海道",
    nameW:  "北アメリカ",
    latW:   40.0, lngW: -100.0,
    wikiW:  "https://ja.wikipedia.org/wiki/北アメリカ",
    zoomJP: 7, zoomW: 5
  },
  {
    nameJP: "本州",
    latJP: 35.0, lngJP: 137.0,
    wikiJP: "https://ja.wikipedia.org/wiki/本州",
    nameW:  "ユーラシア大陸",
    latW:   50.0, lngW: 60.0,
    wikiW:  "https://ja.wikipedia.org/wiki/ユーラシア大陸",
    zoomJP: 7, zoomW: 5
  },
  {
    nameJP: "四国",
    latJP: 33.0, lngJP: 133.0,
    wikiJP: "https://ja.wikipedia.org/wiki/四国",
    nameW:  "オーストラリア",
    latW:   -25.0, lngW: 135.0,
    wikiW:  "https://ja.wikipedia.org/wiki/オーストラリア",
    zoomJP: 7, zoomW: 6
  },
  {
    nameJP: "九州",
    latJP: 32.0, lngJP: 130.0,
    wikiJP: "https://ja.wikipedia.org/wiki/九州",
    nameW:  "アフリカ大陸",
    latW:   5.0, lngW: 20.0,
    wikiW:  "https://ja.wikipedia.org/wiki/アフリカ",
    zoomJP: 7, zoomW: 5
  },
  {
    nameJP: "琵琶湖",
    latJP: 35.1880, lngJP: 136.1939,
    wikiJP: "https://ja.wikipedia.org/wiki/琵琶湖",
    nameW:  "カスピ海",
    latW:   42.0, lngW: 50.0,
    wikiW:  "https://ja.wikipedia.org/wiki/カスピ海",
    zoomJP: 8, zoomW: 6
  },
  // ...（中略。元データすべて貼り付け）
  // 省略せず全て入れて下さい
];

// ▼ 従来ツアー用マーカー
const jpMarkers = [];
const wMarkers = [];
const wMarkerElems = {}; // 点滅

pairs.forEach((p, i) => {
  // 日本マーカー
  const jpMarker = L.marker([p.latJP, p.lngJP]).addTo(map);
  jpMarker.bindPopup(`
    <b>${p.nameJP} - ${p.nameW}</b><br>
    <a href="${p.wikiJP}" target="_blank">${p.nameJP}のWikipedia</a><br>
    <a href="${p.wikiW}"  target="_blank">${p.nameW}のWikipedia</a>
    <hr>
    <button onclick="moveToWorld(${i})">対応した地点へ</button>
  `);
  jpMarkers.push(jpMarker);

  // 世界マーカー
  const wMarker = L.marker([p.latW, p.lngW]).addTo(map);
  wMarker.bindPopup(`
    <b>${p.nameW} - ${p.nameJP}</b><br>
    <a href="${p.wikiW}"  target="_blank">${p.nameW}のWikipedia</a><br>
    <a href="${p.wikiJP}" target="_blank">${p.nameJP}のWikipedia</a>
    <hr>
    <button onclick="moveToJapan(${i})">日本に戻る</button>
  `);
  wMarkers.push(wMarker);

  // DOM取得 (点滅用)
  wMarker.on('add', () => {
    wMarkerElems[i] = wMarker.getElement();
  });
});

// ▼ 従来ツアーの移動 & 点滅
function moveToWorld(i) {
  const p = pairs[i];
  map.flyTo([p.latW, p.lngW], p.zoomW);
  setTimeout(() => {
    wMarkers[i].openPopup();
    blinkWorldMarker(i);
  }, 1000);
}
function moveToJapan(i) {
  const p = pairs[i];
  map.flyTo([p.latJP, p.lngJP], p.zoomJP);
  setTimeout(() => {
    jpMarkers[i].openPopup();
    removeAllBlinks();
  }, 1000);
}
function blinkWorldMarker(i) {
  removeAllBlinks();
  if (wMarkerElems[i]) {
    wMarkerElems[i].classList.add('blink-marker');
    setTimeout(() => {
      wMarkerElems[i]?.classList.remove('blink-marker');
    }, 3000);
  }
}
function removeAllBlinks() {
  Object.values(wMarkerElems).forEach(el => {
    el.classList.remove('blink-marker');
  });
}

// ▼ 従来ツアー自動巡回(4秒おき)
let autoTourTimer = null;
let autoTourIndex = 0;
let goingToWorld = true;

function startAutoTour() {
  stopAutoTour();
  document.getElementById("auto-tour-btn").style.display = "none";
  document.getElementById("stop-btn").style.display = "inline-block";

  autoTourIndex = 0;
  goingToWorld = true;
  autoTourNext();
}
function autoTourNext() {
  if (autoTourIndex >= pairs.length) {
    autoTourIndex = 0;
  }
  if (goingToWorld) {
    moveToWorld(autoTourIndex);
    autoTourTimer = setTimeout(() => {
      goingToWorld = false;
      autoTourNext();
    }, 4000);
  } else {
    moveToJapan(autoTourIndex);
    autoTourTimer = setTimeout(() => {
      goingToWorld = true;
      autoTourIndex++;
      autoTourNext();
    }, 4000);
  }
}
function stopAutoTour() {
  if (autoTourTimer) {
    clearTimeout(autoTourTimer);
    autoTourTimer = null;
  }
  document.getElementById("stop-btn").style.display = "none";
  document.getElementById("auto-tour-btn").style.display = "inline-block";

  removeAllBlinks();
  removeAllPopups();
  showStatusMessage("日本は世界の縮図ツアーを停止しました。");
}
function removeAllPopups() {
  jpMarkers.forEach(m => m.closePopup());
  wMarkers.forEach(m => m.closePopup());
}

////////////////////////////////////////////////////////////////////////////////
// 3. 万国巡幸ツアー(竹内文書の記録にある上古第三代天皇の万国巡幸による) => (© 2024 皇祖皇太神宮) (MIT除外)
////////////////////////////////////////////////////////////////////////////////
// ここでは "ancientData" に座標 & 文章をまとめる

const ancientData = [
  {
    lat: 32.06, lng: 119.00, zoom: 6,
    title: "① 鎮江・チェンヤン(南京のそば)",
    text: `© 2024 皇祖皇太神宮, All Rights Reserved (MIT除外)<br>
支那王盤邦王民、天皇御膳に唐みしを献ず。<br>
天皇詏して支那国主に命ず`
  },
  {
    lat: 38.87, lng: 115.46, zoom: 6,
    title: "② 保定(北京と天津のそば)",
    text: `© 2024 皇祖皇太神宮, All Rights Reserved (MIT除外)<br>
ヨイモツアダムイブヒアカヒ女氏五色人<br>
早刻に来りて、<br>
黄人皇主天皇に草花を奉献。<br>
天皇詏して、アカヒ女氏別五色人<br>
居る所の国王に任ず`
  },
  {
    lat: 45.44, lng: 12.34, zoom: 7,
    title: "③ イタリヤのウェネチャ(ベニス)",
    text: `© 2024 皇祖皇太神宮, All Rights Reserved (MIT除外)<br>
アフリカのネネアホマ浜(ギニアの近く)<br>
アフリアビシアム民王、<br>
アスカリトキンコンコク主民王。<br>
天日豊本黄人皇主天皇へキバナを奉献。<br>
詏して国王に任ず`
  },
  {
    lat: -37.81, lng: 144.96, zoom: 7,
    title: "④ オセアニアのメルボルン浜",
    text: `© 2024 皇祖皇太神宮, All Rights Reserved (MIT除外)<br>
ハウライムタイ尊者、ダイビ民玉、<br>
天皇大前に礼をす。天皇詏して国主に命ず`
  },
  {
    lat: -34.60, lng: -58.38, zoom: 6,
    title: "⑤ 南アメリカのラブラタ浜",
    text: `© 2024 皇祖皇太神宮, All Rights Reserved (MIT除外)<br>
天皇御臨幸、ヒウケイヒロブラシルコ民王、<br>
ヒウケフラジルバラ民王、<br>
天皇大前参朝して地面図を奉献。<br>
天皇詏して二人を国主に命ず`
  },
  {
    lat: 63.0, lng: -80.0, zoom: 4,
    title: "⑥ 北米カナダのニトアーク浜",
    text: `© 2024 皇祖皇太神宮, All Rights Reserved (MIT除外)<br>
天皇に、アヒイタマヲ王アカ民王、<br>
エスキマルカス民王、参朝拝礼し、<br>
天皇詏して国主に命ず。<br>
此時よりカナイシ国と云う`
  },
  {
    lat: 37.0, lng: 140.7, zoom: 7,
    title: "⑦ 常盤国おつき浜",
    text: `© 2024 皇祖皇太神宮, All Rights Reserved (MIT除外)<br>
万国巡幸始より、千九百五十年目の<br>
カナメツキマドノミツヒ、万国より、<br>
吉道路常磐国大付浜に帰京。<br>
其所を唐カラ帰里と名付ける`
  }
];

// マーカー生成 (万国巡幸)
const redIcon = L.icon({
  iconUrl: "https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-red.png",
  shadowUrl: "https://unpkg.com/leaflet/dist/images/marker-shadow.png",
  iconSize: [25, 41],
  iconAnchor: [12, 41],
  popupAnchor: [1, -34],
  shadowSize: [41, 41]
});

const ancientMarkers = [];
ancientData.forEach(spot => {
  const popupHTML = `<b>${spot.title}</b><br>${spot.text}`;
  const marker = L.marker([spot.lat, spot.lng], { icon: redIcon }).addTo(map);
  marker.bindPopup(popupHTML);
  ancientMarkers.push({ marker, zoom: spot.zoom });
});

// 万国巡幸ツアー 自動巡回
let ancientTourTimer = null;
let ancientTourIndex = 0;

function startAncientTour() {
  stopAncientTour();
  document.getElementById("ancient-tour-btn").style.display = "none";
  document.getElementById("ancient-stop-btn").style.display = "inline-block";

  ancientTourIndex = 0;
  moveAncientNext();
}

function moveAncientNext() {
  if (ancientTourIndex >= ancientMarkers.length) {
    ancientTourIndex = 0;
  }
  const spot = ancientMarkers[ancientTourIndex];
  map.flyTo(spot.marker.getLatLng(), spot.zoom);

  // 2秒後にポップアップを開き、6秒後に次へ
  setTimeout(() => {
    spot.marker.openPopup();
    ancientTourTimer = setTimeout(() => {
      ancientTourIndex++;
      moveAncientNext();
    }, 6000);
  }, 2000);
}

function stopAncientTour() {
  if (ancientTourTimer) {
    clearTimeout(ancientTourTimer);
    ancientTourTimer = null;
  }
  document.getElementById("ancient-stop-btn").style.display = "none";
  document.getElementById("ancient-tour-btn").style.display = "inline-block";

  removeAllAncientPopups();
  showStatusMessage("万国巡幸ツアーを停止しました。");
}

function removeAllAncientPopups() {
  ancientMarkers.forEach(obj => obj.marker.closePopup());
}

////////////////////////////////////////////////////////////////////////////////
// 4. 停止メッセージ表示
////////////////////////////////////////////////////////////////////////////////
function showStatusMessage(msg) {
  const statusEl = document.getElementById("statusMessage");
  statusEl.textContent = msg;
  statusEl.style.display = "block";
  setTimeout(() => {
    statusEl.style.display = "none";
  }, 3000);
}
</script>
</body>
</html>